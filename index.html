<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kyle's AI Assistant</title>
  <style>
    body {
      background: linear-gradient(135deg, #001628, #005979);
      color: #fff;
      font-family: Helvetica, Arial, sans-serif;
      margin: 0;
    }
    header {
      background: #005979;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    header img {
      position: absolute; top: 15px; left: 15px;
      width: 50px; height: auto;
    }
    h1 { margin: 0; font-size: 2rem; }

    .tabs {
      display: flex; max-width: 500px; margin: 20px auto;
      background: #012d40; border-radius: 25px; overflow: hidden;
    }
    .tab {
      flex: 1; text-align: center; padding: 10px;
      cursor: pointer; transition: .3s;
      background: #012d40; color: #888;
    }
    .tab.active { background: #005979; color: #fff; }

    .content { display: none; padding: 20px; max-width: 1200px; margin: auto; }
    .content.active { display: block; }

    table {
      width: 100%; border-collapse: collapse;
      background: #012d40; margin-top: 10px;
    }
    th, td {
      padding: 8px; border: 1px solid #005979;
      color: #fff; text-align: left;
    }
    th { background: #005979; cursor: pointer; }

    /* Lineups */
    .lineups-container h3 { margin-top: 30px; }
    .forwards-row, .defense-row {
      display: grid; font-weight: bold; margin-bottom: 5px;
    }
    .forwards-row { grid-template-columns: 1fr 1fr 1fr 50px; }
    .defense-row  { grid-template-columns: 1fr 1fr 50px; }

    .forwards-line, .defense-line {
      display: grid; grid-gap: 15px; margin-bottom: 15px;
    }
    .forwards-line { grid-template-columns: 1fr 1fr 1fr 50px; }
    .defense-line  { grid-template-columns: 1fr 1fr 50px; }

    .slot, .chip {
      background: #005979; border-radius: 5px;
      min-height: 80px; display: flex;
      align-items: center; justify-content: center;
      text-align: center; padding: 5px;
    }
    .slot.placeholder { background: #e03a3e; }
    .chip { cursor: grab; }
    .chem-box {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: #444; border-radius: 5px;
      color: #fff; font-size: 1rem;
    }
    .chem-box button {
      background: #666; color: #fff;
      border: none; padding: 2px 6px; margin: 2px 0;
      cursor: pointer; border-radius: 3px;
    }
  </style>
</head>
<body>

  <header>
    <img src="https://www.sportslogos.net/logos/65/6528/full/seattle_kraken_primary_logo_2021_sportslogosnet-1736.png" alt="Kraken Logo"/>
    <h1>Kyle's AI Assistant</h1>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="showTab('players')">Player Database</div>
    <div class="tab" onclick="showTab('lineups')">Lineups</div>
    <div class="tab" onclick="showTab('salary')">Salary</div>
  </div>

  <!-- PLAYER DATABASE -->
  <div id="players" class="content active">
    <h2>Player Database</h2>
    <input type="file" id="dataFile"/>
    <button onclick="loadData()">Load Data</button>
    <table id="playerTable">
      <thead>
        <tr>
          <th onclick="sortTable(0)">Name</th>
          <th onclick="sortTable(1)">Position</th>
          <th onclick="sortTable(2)">Age</th>
          <th onclick="sortTable(3)">Contract</th>
          <th onclick="sortTable(4)">Potential</th>
          <th onclick="sortTable(5)">Goals</th>
          <th onclick="sortTable(6)">Assists</th>
          <th onclick="sortTable(7)">Points</th>
        </tr>
      </thead>
      <tbody id="playerTableBody"></tbody>
    </table>
  </div>

  <!-- LINEUPS -->
  <div id="lineups" class="content">
    <h2>Lineups</h2>
    <div class="lineups-container">
      <h3>Forwards</h3>
      <div class="forwards-row">
        <div>LW</div><div>C</div><div>RW</div><div>Chem</div>
      </div>
      <div id="forwards"></div>

      <h3>Defense</h3>
      <div class="defense-row">
        <div>LD</div><div>RD</div><div>Chem</div>
      </div>
      <div id="defense"></div>

      <h3>Goalies</h3>
      <div id="goalies" class="forwards-line"></div>
    </div>
  </div>

  <!-- SALARY -->
  <div id="salary" class="content">
    <h2>Salary Analysis</h2>
    <div id="salaryContent"></div>
  </div>

  <script>
    // global players array
    let players = [];

    // Tab switching
    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
      if (tabId === 'players') buildPlayerTable();
      if (tabId === 'lineups')  buildLineups();
      if (tabId === 'salary')   buildSalaryTables();
    }

    // Load players.json
    function loadData() {
      const file = document.getElementById('dataFile').files[0];
      if (!file) return alert('Select a file');
      const reader = new FileReader();
      reader.onload = e => {
        players = JSON.parse(e.target.result);
        buildPlayerTable();
        buildLineups();
      };
      reader.readAsText(file);
    }

    // PLAYER DATABASE
    function buildPlayerTable() {
      const tbody = document.getElementById('playerTableBody');
      tbody.innerHTML = '';
      players.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.name}</td>
          <td>${p.position}</td>
          <td>${p.age}</td>
          <td>${p.contract}</td>
          <td>${p.potential|| '-'}</td>
          <td>${p.goals|| '-'}</td>
          <td>${p.assists|| '-'}</td>
          <td>${p.points|| '-'}</td>
        `;
        tbody.appendChild(tr);
      });
    }
    function sortTable(col) {
      const table = document.getElementById('playerTable');
      const rows = Array.from(table.rows).slice(1);
      const sorted = rows.sort((a,b) => {
        const A = a.cells[col].textContent.trim(), B = b.cells[col].textContent.trim();
        const numA = parseFloat(A), numB = parseFloat(B);
        return !isNaN(numA) && !isNaN(numB) ? numA - numB : A.localeCompare(B);
      });
      sorted.forEach(r => table.tBodies[0].appendChild(r));
    }

    // LINEUPS
    let chipId = 0;
    function buildLineups() {
      const fC = document.getElementById('forwards');
      const dC = document.getElementById('defense');
      const gC = document.getElementById('goalies');
      fC.innerHTML = ''; dC.innerHTML = ''; gC.innerHTML = '';

      // FORWARDS: 4 lines of 3 + chem
      const fList = players.filter(p=>['LW','C','RW'].includes(p.position));
      for (let i=0;i<4;i++){
        const row = document.createElement('div');
        row.classList.add('forwards-line');
        ['LW','C','RW'].forEach(pos=>{
          const slot = makeSlot();
          // place player if matches
          const pl = fList.find(p=>!p._placed && p.position===pos);
          if(pl){ slot.appendChild(makeChip(pl)); pl._placed = true;}
          row.appendChild(slot);
        });
        row.appendChild(makeChem());
        fC.appendChild(row);
      }
      // clear placed flags
      fList.forEach(p=>delete p._placed);

      // DEFENSE: 3 lines of 2 + chem
      const dList = players.filter(p=>['LD','RD'].includes(p.position));
      for (let i=0;i<3;i++){
        const row = document.createElement('div');
        row.classList.add('defense-line');
        ['LD','RD'].forEach(pos=>{
          const slot = makeSlot();
          const pl = dList.find(p=>!p._placed && p.position===pos);
          if(pl){ slot.appendChild(makeChip(pl)); pl._placed = true;}
          row.appendChild(slot);
        });
        row.appendChild(makeChem());
        dC.appendChild(row);
      }
      dList.forEach(p=>delete p._placed);

      // GOALIES
      players.filter(p=>p.position==='G').forEach(p=>{
        gC.appendChild(makeChip(p));
      });
    }

    function makeSlot() {
      const slot = document.createElement('div');
      slot.classList.add('slot');
      slot.addEventListener('dragover', e=>e.preventDefault());
      slot.addEventListener('drop', onDrop);
      return slot;
    }
    function makeChip(p) {
      const chip = document.createElement('div');
      chip.classList.add('chip');
      chip.draggable = true;
      chip.id = 'chip-'+(chipId++);
      chip.addEventListener('dragstart', onDrag);
      chip.innerHTML = p
        ? `<strong>${p.name}</strong><br>${p.position}, Age:${p.age}`
        : 'Player Needed';
      return chip;
    }
    function onDrag(e) {
      e.dataTransfer.setData('text/plain', e.target.id);
    }
    function onDrop(e) {
      const id = e.dataTransfer.getData('text/plain');
      const dragged = document.getElementById(id);
      // if slot already has chip, swap
      const existing = e.target.querySelector('.chip');
      if (existing) {
        const orig = dragged.parentElement;
        orig.appendChild(existing);
      }
      e.target.appendChild(dragged);
    }
    function makeChem() {
      const box = document.createElement('div');
      box.classList.add('chem-box');
      const display = document.createElement('div');
      display.textContent = 0;
      const plus = document.createElement('button');
      plus.textContent = '+';
      const minus = document.createElement('button');
      minus.textContent = 'â€“';
      plus.onclick = ()=> display.textContent = Math.min(5, +display.textContent+1);
      minus.onclick= ()=> display.textContent = Math.max(-5,+display.textContent-1);
      box.append(display, plus, minus);
      return box;
    }

    // SALARY (unchanged from final you approved)
    function buildSalaryTables() {
      const salaryContent = document.getElementById('salaryContent');
      salaryContent.innerHTML = '';
      const groups = [
        { title:'Forwards', list: players.filter(p=>['LW','C','RW'].includes(p.position)) },
        { title:'Defense',  list: players.filter(p=>['LD','RD'].includes(p.position)) },
        { title:'Goalies',  list: players.filter(p=>p.position==='G') }
      ];
      groups.forEach(g=>{
        const tbl = document.createElement('div');
        tbl.innerHTML = `<h3>${g.title}</h3>`;
        const t = document.createElement('table');
        const h = document.createElement('tr');
        if(g.title==='Goalies') {
          h.innerHTML = `<th>Name</th><th>Age</th><th>Contract</th><th>GAA</th><th>SV%</th><th>Proj $</th><th>Status</th>`;
        } else {
          h.innerHTML = `<th>Name</th><th>Age</th><th>Contract</th><th>Goals</th><th>Assists</th><th>Points</th><th>Proj $</th><th>Status</th>`;
        }
        t.append(h);
        g.list.sort((a,b)=>a.name.localeCompare(b.name)).forEach(p=>{
          const row = document.createElement('tr');
          const proj = projectSalary(p, g.title==='Goalies');
          const cur = parseFloat(p.contract.split('M')[0].replace('$',''));
          const status = proj>cur?'Underpaid': proj<cur?'Overpaid':'Fair';
          if(g.title==='Goalies'){
            row.innerHTML = `<td>${p.name}</td><td>${p.age}</td><td>${p.contract}</td><td>${p.gaa}</td><td>${p.savePct}</td><td>$${proj.toFixed(1)}M</td><td>${status}</td>`;
          } else {
            row.innerHTML = `<td>${p.name}</td><td>${p.age}</td><td>${p.contract}</td><td>${p.goals}</td><td>${p.assists}</td><td>${p.points}</td><td>$${proj.toFixed(1)}M</td><td>${status}</td>`;
          }
          t.append(row);
        });
        tbl.appendChild(t);
        salaryContent.appendChild(tbl);
      });
    }
    function projectSalary(p, isG) {
      let val = isG
        ? 3 + 0.02*(p.savePct*100) - 0.1*p.gaa
        : 0.13*p.points;
      if(p.age<26) val*=1.1;
      if(p.age>32) val*=0.9;
      if(/(Elite|Franchise)/.test(p.potential)) val*=1.1;
      return val;
    }
  </script>
</body>
</html>
