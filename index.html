<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kyle's AI Assistant</title>
  <style>
    body {
      background: linear-gradient(135deg, #001628, #005979);
      color: #fff;
      font-family: Helvetica, Arial, sans-serif;
      margin: 0;
    }
    header {
      background: #005979;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    header img {
      position: absolute; top: 15px; left: 15px;
      width: 50px; height: auto;
    }
    h1 { margin: 0; font-size: 2rem; }

    .tabs {
      display: flex; max-width: 300px; margin: 20px auto;
      background: #012d40; border-radius: 25px; overflow: hidden;
    }
    .tab {
      flex: 1; text-align: center; padding: 10px;
      cursor: pointer; transition: .3s;
      background: #012d40; color: #888;
    }
    .tab.active { background: #005979; color: #fff; }

    .content { display: none; padding: 20px; max-width: 1400px; margin: auto; }
    .content.active { display: block; }

    table {
      width: 100%; border-collapse: collapse;
      background: #012d40; margin-top: 10px;
    }
    th, td {
      padding: 8px; border: 1px solid #005979;
      color: #fff; text-align: left;
    }
    th { background: #005979; cursor: pointer; }

    /* Lineups */
    .lineups-container h3 { margin-top: 30px; }
    .forwards-row, .defense-row {
      display: grid; font-weight: bold; margin-bottom: 5px;
    }
    .forwards-row { grid-template-columns: repeat(3,1fr) 50px; }
    .defense-row  { grid-template-columns: repeat(2,1fr) 50px; }

    .forwards-line, .defense-line {
      display: grid; gap: 15px; margin-bottom: 15px;
    }
    .forwards-line { grid-template-columns: repeat(3,1fr) 50px; }
    .defense-line  { grid-template-columns: repeat(2,1fr) 50px; }

    .slot, .chip {
      background: #005979; border-radius: 5px;
      min-height: 80px; display: flex;
      align-items: center; justify-content: center;
      text-align: center; padding: 5px;
    }
    .chip.placeholder { background: #e03a3e; }
    .chip { cursor: grab; }
    .chem-box {
      width: 50px; height: 80px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      font-weight: bold; border-radius: 5px;
    }
    .chem-positive { background: #008000; }
    .chem-neutral  { background: #999; }
    .chem-negative { background: #e03a3e; }
    .chem-controls {
      display: flex; flex-direction: column; gap: 2px; margin-top: 4px;
    }
    .chem-controls button {
      font-size: 0.7rem; padding: 2px;
      background: #666; color: #fff; border: none; border-radius: 3px;
      cursor: pointer;
    }

    /* Salary tables */
    .salary-table { margin-top: 20px; }
    .salary-table h3 { margin-bottom: 5px; }
  </style>
</head>
<body>

  <header>
    <img src="https://www.sportslogos.net/logos/65/6528/full/seattle_kraken_primary_logo_2021_sportslogosnet-1736.png" alt="Kraken Logo"/>
    <h1>Kyle's AI Assistant</h1>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="showTab('players')">Player Database</div>
    <div class="tab" onclick="showTab('lineups')">Lineups</div>
    <div class="tab" onclick="showTab('salary')">Salary</div>
  </div>

  <!-- PLAYER DATABASE -->
  <div id="players" class="content active">
    <h2>Upload Player Data (JSON)</h2>
    <input type="file" id="dataFile"/>
    <button onclick="loadData()">Load Data</button>

    <h2>Player Stats</h2>
    <table id="playerTable">
      <thead>
        <tr>
          <th>Name</th><th>Position</th><th>Age</th><th>Overall</th>
          <th>Contract</th><th>Potential</th><th>Projected Salary</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- LINEUPS -->
  <div id="lineups" class="content">
    <div class="lineups-container">
      <h2>Lineups</h2>

      <h3>Forwards</h3>
      <div class="forwards-row"><div>LW</div><div>C</div><div>RW</div><div>Chem</div></div>
      <div id="forwards"></div>

      <h3>Defense</h3>
      <div class="defense-row"><div>LD</div><div>RD</div><div>Chem</div></div>
      <div id="defense"></div>

      <h3>Goalies</h3>
      <div id="goalies" class="line"></div>
    </div>
  </div>

  <!-- SALARY -->
  <div id="salary" class="content">
    <h2>Salary Analysis</h2>
    <div id="salaryContent"></div>
  </div>

<script>
  let players = [], initialized = false, chemValues = { forwards:[0,0,0,0], defense:[0,0,0] };

  function showTab(tabId) {
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
    document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
    document.getElementById(tabId).classList.add('active');
    if(tabId==='players') buildPlayerTable();
    if(tabId==='lineups' && !initialized){ buildLineups(); initialized=true; }
    if(tabId==='salary') buildSalaryTables();
  }

  function loadData() {
    const f = document.getElementById('dataFile').files[0];
    if(!f) return alert('Please select a file!');
    const r = new FileReader();
    r.onload = e=>{
      players = JSON.parse(e.target.result);
      displayData(players);
      buildLineups();
    };
    r.readAsText(f);
  }

  // PLAYER TABLE
  function displayData(players){
    const tb = document.querySelector('#playerTable tbody');
    tb.innerHTML = '';
    players.forEach(p=>{
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${p.name}</td>
        <td>${p.position}</td>
        <td>${p.age}</td>
        <td>${p.overall}</td>
        <td>${p.contract}</td>
        <td>${p.potential}</td>
        <td>${projectSalary(p, p.position==='G')}<\/td>
      `;
      tb.appendChild(row);
    });
  }

  // LINEUPS (exactly your final)
  function buildLineups(){
    const fC=document.getElementById('forwards'),
          dC=document.getElementById('defense'),
          gC=document.getElementById('goalies');
    fC.innerHTML=''; dC.innerHTML=''; gC.innerHTML='';

    const fList=players.filter(p=>['LW','C','RW'].includes(p.position)),
          dList=players.filter(p=>['LD','RD'].includes(p.position)),
          gList=players.filter(p=>p.position==='G');

    let fi=0;
    for(let i=0;i<4;i++){
      const line=document.createElement('div'); line.classList.add('forwards-line');
      ['LW','C','RW'].forEach(pos=>{
        const slot=document.createElement('div'); slot.classList.add('slot');
        const p=fList.find((x,idx)=>!x._placed&&x.position===pos&&(x._placed=true, true));
        slot.appendChild(makeChip(p)); line.appendChild(slot);
      });
      line.appendChild(createChemBox('forwards',i)); fC.appendChild(line);
    }
    fList.forEach(x=>delete x._placed);

    for(let i=0;i<3;i++){
      const line=document.createElement('div'); line.classList.add('defense-line');
      ['LD','RD'].forEach(pos=>{
        const slot=document.createElement('div'); slot.classList.add('slot');
        const p=dList.find((x,idx)=>!x._placed&&x.position===pos&&(x._placed=true, true));
        slot.appendChild(makeChip(p)); line.appendChild(slot);
      });
      line.appendChild(createChemBox('defense',i)); dC.appendChild(line);
    }
    dList.forEach(x=>delete x._placed);

    gList.forEach(p=>gC.appendChild(makeChip(p)));
    enableGlobalDragAndDrop();
  }

  function makeChip(player){
    const chip=document.createElement('div');
    chip.classList.add('chip');
    if(!player) chip.classList.add('placeholder');
    chip.draggable=true;
    chip.innerHTML=player?`<strong>${player.name}</strong><br>${player.position}, Age:${player.age}`:'Player Needed';
    chip.ondragstart=e=>e.dataTransfer.setData('text', player?player.name:'');
    return chip;
  }

  function createChemBox(type,i){
    const box=document.createElement('div'); box.classList.add('chem-box');
    updateChemColor(box, chemValues[type][i]);
    box.textContent=chemValues[type][i];
    const ctrls=document.createElement('div'); ctrls.classList.add('chem-controls');
    ['+','â€“'].forEach(sym=>{
      const b=document.createElement('button'); b.textContent=sym;
      b.onclick=()=>{
        chemValues[type][i]=Math.max(-5,Math.min(5,chemValues[type][i]+(sym==='+'?1:-1)));
        box.firstChild.textContent=chemValues[type][i];
        updateChemColor(box, chemValues[type][i]);
      };
      ctrls.appendChild(b);
    });
    box.appendChild(ctrls);
    return box;
  }

  function updateChemColor(box,v){
    box.classList.remove('chem-positive','chem-neutral','chem-negative');
    box.classList.add(v>0?'chem-positive':v<0?'chem-negative':'chem-neutral');
  }

  function enableGlobalDragAndDrop(){
    document.querySelectorAll('.chip').forEach(chip=>{
      chip.addEventListener('dragover',e=>e.preventDefault());
      chip.addEventListener('drop',e=>{
        e.preventDefault();
        const srcName = e.dataTransfer.getData('text'),
              tgtName = chip.querySelector('strong')?.textContent;
        if(!srcName||!tgtName||srcName===tgtName) return;
        const si=players.findIndex(p=>p.name===srcName),
              ti=players.findIndex(p=>p.name===tgtName);
        [players[si],players[ti]]=[players[ti],players[si]];
        buildLineups();
      });
    });
  }

  // SALARY
  function buildSalaryTables(){
    const sc=document.getElementById('salaryContent'); sc.innerHTML='';
    const groups=[
      {t:'Forwards',list:players.filter(p=>['LW','C','RW'].includes(p.position))},
      {t:'Defense', list:players.filter(p=>['LD','RD'].includes(p.position))},
      {t:'Goalies', list:players.filter(p=>p.position==='G')}
    ];
    groups.forEach(g=>{
      const cont=document.createElement('div'); cont.classList.add('salary-table');
      cont.innerHTML=`<h3>${g.t}</h3>`;
      const tbl=document.createElement('table'),
            hdr=document.createElement('tr');
      if(g.t==='Goalies') hdr.innerHTML=
        `<th>Name</th><th>Age</th><th>Contract</th><th>GAA</th><th>SV%</th><th>Proj $</th><th>Status</th>`;
      else hdr.innerHTML=
        `<th>Name</th><th>Age</th><th>Contract</th><th>Goals</th><th>Assists</th><th>Points</th><th>Proj $</th><th>Status</th>`;
      tbl.appendChild(hdr);
      g.list.sort((a,b)=>a.name.localeCompare(b.name)).forEach(p=>{
        const row=document.createElement('tr'),
              proj=projectSalary(p, g.t==='Goalies'),
              cur=parseFloat(p.contract.split('M')[0].replace('$','')),
              st=proj>cur?'Underpaid':proj<cur?'Overpaid':'Fair';
        if(g.t==='Goalies'){
          row.innerHTML=
            `<td>${p.name}</td><td>${p.age}</td><td>${p.contract}</td><td>${p.gaa}</td><td>${p.savePct}</td><td>$${proj.toFixed(1)}M</td><td>${st}</td>`;
        } else {
          row.innerHTML=
            `<td>${p.name}</td><td>${p.age}</td><td>${p.contract}</td><td>${p.goals}</td><td>${p.assists}</td><td>${p.points}</td><td>$${proj.toFixed(1)}M</td><td>${st}</td>`;
        }
        tbl.appendChild(row);
      });
      cont.appendChild(tbl);
      sc.appendChild(cont);
    });
  }

  function projectSalary(p,isG){
    let v = isG
      ? 3 + 0.02*(p.savePct*100) - 0.1*p.gaa
      : 0.13*p.points;
    if(p.age<26) v*=1.1;
    if(p.age>32) v*=0.9;
    if(/(Elite|Franchise)/.test(p.potential)) v*=1.1;
    return v;
  }
</script>
</body>
</html>
